================================================================================
PHARMACEUTICAL ANALYTICS SYSTEM - COMPREHENSIVE EXPLANATION
================================================================================

WHAT THIS SYSTEM DOES
----------------------
This is an advanced pharmaceutical analytics platform that analyzes prescribing patterns
and predicts future prescribing behavior for any drug comparison query. It's designed
for market researchers and pharmaceutical companies to understand how healthcare 
providers prescribe competing medications.

The system can answer queries like:
- "Which doctors prescribe Tremfya vs Rinvoq?"
- "What types of doctors are more likely to prescribe drug A over drug B?"
- "Predict which doctors will switch from one drug to another next month"
- "Identify behavioral profiles of prescribers for targeted interventions"


HOW IT WORKS - TECHNICAL OVERVIEW
----------------------------------

1. QUERY PROCESSING
   - User enters a natural language query
   - System classifies query type (descriptive, predictive, behavioral, comparative)
   - Routes to appropriate analysis pipeline

2. DYNAMIC CODE GENERATION
   - Instead of using pre-written algorithms, the system uses GPT-4 to generate
     custom analysis code for each specific query
   - This ensures the statistical methods match the exact question being asked
   - Generated code includes appropriate statistical tests, ML models, and visualizations

3. DATA INTEGRATION
   - Connects to 5 BigQuery datasets:
     * rx_claims: Prescription data with drug, prescriber, dates
     * medical_claims: Diagnoses and procedures
     * providers_bio: Provider demographics and characteristics
     * provider_payments: Industry payments to providers
     * us_npi_doctors: National provider registry
   - Falls back to synthetic sample data if BigQuery is unavailable

4. PROBABILITY CALCULATION
   - Uses pattern-based scoring (NO hardcoded thresholds)
   - Analyzes temporal consistency, volume stability, and recency
   - Applies continuous mathematical functions:
     * Sigmoid curves for smooth probability mapping
     * Exponential decay for time weighting
     * Statistical tests (binomial, chi-square, z-tests)
   - Scores range from 0.0 to 0.99 based on prescribing patterns

5. VISUALIZATION GENERATION
   The system creates a 5-graph dashboard:
   
   a) Prescriber Distribution Heatmap (16 quadrants)
      - Shows how many doctors fall into each probability range
      - X-axis: Drug 1 probability (0-25%, 25-50%, 50-75%, 75-100%)
      - Y-axis: Drug 2 probability (same ranges)
      
   b) Individual Prescriber Distribution
      - Scatter plot of all prescribers
      - Size/color indicates prescription volume
      - Reference lines at 0.5 probability
      
   c) Prescribing by Specialty
      - Bar chart comparing average probabilities by specialty
      - Shows which specialties favor which drug
      
   d) Volume Distribution by Drug Preference
      - Histogram showing prescription volumes
      - Separated by drug preference
      
   e) Experience vs Drug Preference
      - Scatter plot of years of experience vs preference
      - Colored by specialty

6. REPORT GENERATION
   - Creates timestamped folder for each query
   - Generates comprehensive text report with:
     * Analysis of each quadrant (100-150 words)
     * Non-technical language for marketers
     * Statistical evidence and confidence levels
     * Actionable insights


USE CASES
---------

1. MARKET ACCESS STRATEGY
   - Identify high-value prescribers for drug adoption
   - Target doctors likely to switch from competitors
   - Understand specialty-specific prescribing patterns

2. SALES FORCE OPTIMIZATION
   - Prioritize prescribers with highest conversion potential
   - Identify under-penetrated segments
   - Track prescribing behavior changes over time

3. COMPETITIVE INTELLIGENCE
   - Compare market share by prescriber segment
   - Analyze switching patterns between drugs
   - Predict competitive threats

4. CLINICAL EDUCATION
   - Identify prescribers needing education on new therapies
   - Target specialists with specific patient populations
   - Measure impact of educational interventions

5. PREDICTIVE ANALYTICS
   - Forecast next month's prescribing probabilities
   - Identify prescribers likely to adopt new drugs
   - Predict market share changes


KEY INNOVATIONS
---------------

1. NO HARDCODED RULES
   - All calculations use continuous mathematical functions
   - Probabilities adjust dynamically based on actual patterns
   - No fixed thresholds like "if 3 months then probability = 0.75"

2. LLM-POWERED ANALYSIS
   - Generates custom code for each query
   - Selects appropriate statistical methods automatically
   - Adapts to any drug comparison or analysis request

3. PATTERN RECOGNITION
   - Identifies trends, seasonality, switching behaviors
   - Uses machine learning to find hidden patterns
   - Predicts future behavior based on historical data

4. STATISTICAL RIGOR
   - Proper p-value calculations using established tests
   - Confidence intervals and effect sizes
   - Multiple testing corrections (Bonferroni, FDR)

5. PRODUCTION READY
   - Robust error handling and fallbacks
   - Caching for performance optimization
   - Clean, modular architecture


OUTPUT INTERPRETATION
---------------------

PROBABILITY SCORES (0.00 - 0.99):
- 0.00-0.25: Low likelihood of prescribing
- 0.25-0.50: Moderate likelihood
- 0.50-0.75: High likelihood
- 0.75-0.99: Very high likelihood

P-VALUES:
- < 0.05: Statistically significant prescribing pattern
- 0.05-0.10: Marginally significant
- > 0.10: Not statistically significant

HEATMAP QUADRANTS:
- Top-right: High probability for both drugs (dual prescribers)
- Top-left: High Drug 2 only (selective for Drug 2)
- Bottom-right: High Drug 1 only (selective for Drug 1)
- Bottom-left: Low probability for both (non-prescribers)


TECHNICAL SPECIFICATIONS
------------------------
- Language: Python 3.8+
- ML Libraries: XGBoost, LightGBM, scikit-learn
- Data: Google BigQuery
- LLM: GPT-4 (via OpenAI API)
- Visualization: Matplotlib, Seaborn
- Statistical: SciPy, NumPy, Pandas


ACCURACY AND RELIABILITY
------------------------
- Probabilities based on actual prescribing patterns
- Statistical tests use established methodologies
- P-values calculated using exact tests where applicable
- Confidence intervals using Wilson score method
- Multiple testing corrections applied
- Fallback mechanisms ensure system always returns results


For questions or support, refer to ARCHITECTURE.md for technical details
or SETUP.md for configuration instructions.
